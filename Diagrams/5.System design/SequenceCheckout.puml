@startuml SequenceCheckout
title Data Flow for Product Checkout

actor "Registered\nUser" as User
participant "Browser" as Browser
participant "Web Application\n(.NET MVC)" as WebApp
participant "Database\n(SQL Server)" as DB
participant "Stripe API" as Stripe

User -> Browser : View cart and order details
Browser -> WebApp : HTTP POST /Checkout (finalize order)
WebApp -> DB : Create new order
    activate DB
    DB --> WebApp : Order saved
    deactivate DB
activate WebApp

alt Online Payment (Stripe)
    WebApp -> Stripe : Create payment session
    activate Stripe
    Stripe --> WebApp : Returns payment session
    deactivate Stripe
    WebApp -> Browser : Redirect to Stripe
    Browser -> Stripe : User completes payment
    Stripe --> Browser : Successful payment
    Browser -> WebApp : Redirect with success
    WebApp -> DB : Update order payment status
    activate DB
    DB --> WebApp : Order saved
    deactivate DB
end

WebApp -> Browser : Return success page
deactivate WebApp
Browser -> User : Display confirmation
@enduml