<div class="container mt-4">
    <h4>Live Chat</h4>
    <div id="chatWindow"></div>
    <div class="input-group">
        <input id="messageInput" type="text" class="form-control" placeholder="Type your message..." />
        <button id="sendButton" class="btn btn-primary">Send</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
<script>
    const userId = '@(User.Identity.IsAuthenticated ? User.GetId() : "-1")';

    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/chatHub")
        .build();

    connection.on("ReceiveMessage", function (senderId, message) {
        const messageClass = senderId === userId ? "you" : "other";
        const msgHtml = `<div class="message ${messageClass}"><strong>${senderId}</strong>: ${message}</div>`;

        const chatWindow = $("#chatWindow");

        chatWindow.append(msgHtml);
        chatWindow.scrollTop(chatWindow[0].scrollHeight);
    });

    document.getElementById("sendButton").addEventListener("click", function () {
        const messageInput = $("#messageInput");
        const message = messageInput.val();
        
        connection.invoke("SendMessage", userId, message).catch(err => console.error(err.toString()));

        messageInput.val('');
    });

    connection.start().catch(err => console.error(err.toString()));

    $("#messageInput").on("keypress", function (e) {
        if (e.which === 13) {
            $("#sendButton").click();
        }
    });
</script>